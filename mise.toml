[env]
PROTO_GENERATION = "true"

[tools]
"go:github.com/grafana/oats" = "0.2.0"
java = "temurin-17.0.13+11"
protoc = "latest"

[tasks.ci]
description = "CI Build"
run = [
    "./mvnw clean install",
    # just to check if javadoc can be generated
    "./mvnw javadoc:javadoc -P javadoc"
]
env = { REQUIRE_PROTO_UP_TO_DATE = "true" }

[tasks.format]
description = "format source code"
run = "./mvnw spotless:apply"

[tasks.test]
description = "run unit tests, ignoring formatting and linters"
run = "./mvnw test -DskipTests=true -Dspotless.check.skip=true -Dcoverage.skip=true -Dcheckstyle.skip=true -Dwarnings=-nowarn"

[tasks.test-all]
description = "run all tests"
run = "./mvnw verify"

[tasks.acceptance-test]
description = "Run OATs acceptance tests"
run = "oats -timeout 5m examples/"

[tasks.native-test]
tools.java = "graalvm-21.3.3+java17"
run = "./scripts/run-native-tests.sh"

[settings]
# to get lock file support and for go backend
experimental = true

